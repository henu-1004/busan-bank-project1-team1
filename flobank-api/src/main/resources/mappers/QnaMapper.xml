<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.api.flobankapi.mapper.QnaMapper">

    <resultMap id="QnaResultMap" type="kr.co.api.flobankapi.dto.QnaDTO">
        <id property="qnaNo" column="QNA_NO"/>
        <result property="qnaCustCode" column="QNA_CUST_CODE"/>
        <result property="qnaTitle" column="QNA_TITLE"/>
        <result property="qnaContent" column="QNA_CONTENT"/>
        <result property="qnaDraft" column="QNA_DRAFT"/>
        <result property="qnaReply" column="QNA_REPLY"/>
        <result property="qnaDt" column="QNA_DT" jdbcType="TIMESTAMP"/>
        <result property="qnaHit" column="QNA_HIT"/>
    </resultMap>

    <select id="countQna" resultType="int">
        SELECT COUNT(*)
        FROM TB_QNA_HDR
    </select>

    <select id="selectQnaPage" resultMap="QnaResultMap">
        SELECT *
        FROM (
             SELECT ROW_NUMBER() OVER (ORDER BY QNA_NO DESC) AS RNUM,
                    QNA_NO, QNA_CUST_CODE, QNA_TITLE, QNA_CONTENT,
                    QNA_DRAFT, QNA_REPLY, QNA_DT, QNA_HIT
             FROM TB_QNA_HDR
        ) A
        WHERE A.RNUM BETWEEN #{start} AND #{end}
    </select>

    <select id="selectQnaByNo" resultMap="QnaResultMap">
        SELECT QNA_NO, QNA_CUST_CODE, QNA_TITLE, QNA_CONTENT,
               QNA_DRAFT, QNA_REPLY, QNA_DT, QNA_HIT
        FROM TB_QNA_HDR
        WHERE QNA_NO = #{qnaNo}
    </select>

    <update id="updateQnaHit">
        UPDATE TB_QNA_HDR
        SET QNA_HIT = NVL(QNA_HIT, 0) + 1
        WHERE QNA_NO = #{qnaNo}
    </update>

    <insert id="insertQna" parameterType="kr.co.api.flobankapi.dto.QnaDTO">
        INSERT INTO TB_QNA_HDR (
            QNA_NO,
            QNA_CUST_CODE,
            QNA_TITLE,
            QNA_CONTENT,
            QNA_DRAFT,
            QNA_REPLY,
            QNA_DT,
            QNA_HIT
        ) VALUES (
                 SEQ_QNA_NO.NEXTVAL,
                 #{qnaCustCode},
                 #{qnaTitle},
                 #{qnaContent},
                 #{qnaDraft},
                 #{qnaReply},
                 SYSDATE,
                 0
             )
    </insert>

</mapper>
