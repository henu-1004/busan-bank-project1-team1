<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>환전하기 - FLOBANK</title>
    <link rel="stylesheet" th:href="@{/css/exchange.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />

</head>
<body>
<div th:replace="~{_template/_header.html}"></div>
<main class="step2-container">

    <div class="step2-steps">
        <div class="step2-step">
            <span class="num">1</span>
            <span class="text">약관동의</span>
        </div>
        <div class="step2-step active">
            <span class="num">2</span>
            <span class="text">정보입력</span>
        </div>
        <div class="step2-step">
            <span class="num">3</span>
            <span class="text">환전완료</span>
        </div>
    </div>

    <div class="step2-box">
        <h2 class="step2-title">환전정보 입력</h2>
        <p class="step2-subtitle">환전할 통화와 금액을 입력해주세요.</p>

        <form class="step2-form">

            <div class="exchange-swapper">
                <div class="currency-box">
                    <label>보내실 때 (From)</label>
                    <div class="input-group-merged">
                        <div class="select-prefix">
                            <img id="fromFlag" class="flag-icon" src="/img/flags/usd.png" alt="flag">
                            <select id="fromCurrency" class="hidden-select">
                                <option value="KRW" th:data-flag="@{/images/krw.png}">KRW (대한민국 원)</option>
                                <option value="USD" th:data-flag="@{/images/usd.png}">USD (미국 달러)</option>
                                <option value="JPY" th:data-flag="@{/images/jpy.png}">JPY (일본 엔)</option>
                                <option value="EUR" th:data-flag="@{/images/eur.png}">EUR (유럽 유로)</option>
                                <option value="CNH" th:data-flag="@{/images/cnh.png}">CNH (중국 위안)</option>
                                <option value="GBP" th:data-flag="@{/images/gbp.png}">GBP (영국 파운드)</option>
                                <option value="AUD" th:data-flag="@{/images/aud.png}">AUD (호주 달러)</option>
                            </select>
                            <i class="fa-solid fa-caret-down select-arrow"></i>
                        </div>
                        <input type="number" id="fromAmount" class="amount-input-merged" placeholder="0">
                    </div>
                </div>

                <div class="arrow-icon">
                    <i class="fa-solid fa-arrow-right"></i>
                </div>

                <div class="currency-box">
                    <label>받으실 때 (To)</label>
                    <div class="input-group-merged">
                        <div class="select-prefix">
                            <img id="toFlag" class="flag-icon" src="/img/flags/usd.png" alt="flag">
                            <select id="toCurrency" class="hidden-select">
                                <option value="USD" th:data-flag="@{/images/usd.png}">USD (미국 달러)</option>
                                <option value="KRW" th:data-flag="@{/images/krw.png}">KRW (대한민국 원)</option>
                                <option value="JPY" th:data-flag="@{/images/jpy.png}">JPY (일본 엔)</option>
                                <option value="EUR" th:data-flag="@{/images/eur.png}">EUR (유럽 유로)</option>
                                <option value="CNH" th:data-flag="@{/images/cnh.png}">CNH (중국 위안)</option>
                                <option value="GBP" th:data-flag="@{/images/gbp.png}">GBP (영국 파운드)</option>
                                <option value="AUD" th:data-flag="@{/images/aud.png}">AUD (호주 달러)</option>
                            </select>
                            <i class="fa-solid fa-caret-down select-arrow"></i>
                        </div>
                        <input type="text" id="toAmount" class="amount-input-merged" readonly placeholder="0">
                    </div>
                </div>
            </div>

            <div id="exchangeResult" class="step2-result-box">
                <table class="step2-result-table">
                    <tr>
                        <th>
                            현재고시환율
                            <span class="tooltip-icon">
                                <i class="fa-regular fa-circle-question"></i>
                                <span class="tooltip-text">한국수출입은행 금일 1회차 고시환율이 적용됩니다.</span>
                            </span>
                        </th>
                        <td id="result-base-rate" style="color:#555;">-</td>
                    </tr>
                    <tr>
                        <th>
                            적용 환율 (우대 <span id="spreadRateDisplay">0</span>%)
                            <button type="button" id="couponBtn" class="coupon-btn" style="margin-left:5px; padding:2px 8px; font-size:11px;">쿠폰선택</button>
                        </th>
                        <td id="result-rate" style="font-weight:bold; color:#333;">-</td>
                    </tr>
                    <tr>
                        <th>수수료 (할인적용)</th>
                        <td id="result-fee">-</td>
                    </tr>
                    <tr style="border-top: 1px dashed #ccc;">
                        <th>최종 예상 금액</th> <td id="result-final" style="color:#00907f; font-size:1.2em; font-weight:bold;">0</td>
                    </tr>
                </table>
            </div>

            <hr class="divider" style="margin: 30px 0; border:0; border-top:1px solid #eee;">

            <div class="step2-form-group">
                <label class="step2-label">휴대폰번호</label>
                <div class="step2-flex">
                    <input type="text" class="step2-input small" placeholder="010">
                    <span>-</span>
                    <input type="text" class="step2-input small">
                    <span>-</span>
                    <input type="text" class="step2-input small">
                </div>
            </div>

            <div class="step2-form-group">
                <label class="step2-label" id="withdrawLabel">출금계좌선택 (원화)</label>
                <select id="accountSelectWon" class="step2-select">
                    <option th:each="dto : ${custAcctDTOList}"
                            th:text="|${dto.acctNo} (잔액 ${#numbers.formatInteger(dto.acctBalance, 0, 'COMMA')}원)|"
                            th:value="${dto.acctNo}">
                    </option>
                </select>
                <select id="accountSelectForeign" class="step2-select" style="display:none;">
                    <option th:if="${foreignAcctDTOList == null or #lists.isEmpty(foreignAcctDTOList)}" value="">
                        보유하신 외화 입출금 통장이 없습니다.
                    </option>
                    <option th:each="dto : ${foreignAcctDTOList}"
                            th:text="|${dto.acctNo} (잔액 ${dto.acctBalance} ${dto.currencyCode})|"
                            th:value="${dto.acctNo}">
                    </option>
                </select>
            </div>

            <div class="step2-form-group">
                <label class="step2-label">출금계좌비밀번호</label>
                <input type="password" id="pwInput" class="step2-input short" maxlength="4" placeholder="비밀번호 4자리">
            </div>

            <div id="buySection" class="mode-section">
                <div class="step2-form-group">
                    <label class="step2-label">수령방법</label>
                    <div class="receive-method-group">
                        <button type="button" class="method-btn active" data-value="BRANCH">영업점 방문</button>
                        <button type="button" class="method-btn" data-value="ATM">ATM 수령</button>
                        <input type="hidden" id="receiveMethod" value="BRANCH">
                    </div>
                </div>
                <div class="step2-form-group">
                    <label class="step2-label">수령희망지점</label>
                    <select id="receiveBranch" class="step2-select">
                        <option value="">지점을 선택해주세요</option>

                        <optgroup label="✈️ 공항/항만 환전소 (365일 운영)">
                            <option value="ICN_T1">인천국제공항 제1여객터미널 환전소</option>
                            <option value="ICN_T2">인천국제공항 제2여객터미널 환전소</option>
                            <option value="GMP_INT">김포국제공항 국제선청사</option>
                            <option value="PUS_INT">김해국제공항(부산) 국제선청사</option>
                            <option value="BUSAN_PORT">부산항 국제여객터미널</option>
                        </optgroup>

                        <optgroup label="🏢 서울 주요 영업점">
                            <option value="HQ_YEOUIDO">플로뱅크 여의도 본점</option>
                            <option value="SEOUL_ST">서울역 환전센터 (KTX 2층)</option>
                            <option value="SEOUL_GANGNAM">강남파이낸스센터지점</option>
                            <option value="SEOUL_MYEONG">명동역 외환센터</option>
                            <option value="SEOUL_COEX">삼성동 무역센터지점</option>
                            <option value="SEOUL_HONGDAE">홍대입구역지점</option>
                            <option value="SEOUL_JAMSIL">잠실 롯데월드타워지점</option>
                        </optgroup>

                        <optgroup label="🌊 부산/경남 주요 영업점">
                            <option value="BUSAN_MAIN">플로뱅크 부산금융센터 (문현동)</option>
                            <option value="BUSAN_SEOMYEON">서면 1번가지점</option>
                            <option value="BUSAN_HAEUNDAE">해운대 마린시티지점</option>
                            <option value="BUSAN_NAMPODONG">남포동지점</option>
                            <option value="ULSAN_MAIN">울산 삼산동지점</option>
                        </optgroup>

                        <optgroup label="🌐 기타 지역 거점">
                            <option value="GYEONGGI_PANGYO">판교 테크노밸리지점</option>
                            <option value="INCHEON_SONGDO">인천 송도국제도시지점</option>
                            <option value="DAEGU_MAIN">대구 동성로지점</option>
                            <option value="DAEJEON_MAIN">대전 둔산지점</option>
                            <option value="GWANGJU_MAIN">광주 상무지점</option>
                            <option value="JEJU_AIR">제주공항지점</option>
                        </optgroup>
                    </select>
                </div>
                <div class="step2-form-group">
                    <label class="step2-label">수령희망일</label>
                    <input type="date" id="receiveDate" class="step2-input short">
                </div>
            </div>

            <div id="sellSection" class="mode-section" style="display:none;">
                <div class="step2-form-group">
                    <label class="step2-label">입금받을 계좌 (원화)</label>
                    <select id="depositAccountSelect" class="step2-select">
                        <option th:each="dto : ${custAcctDTOList}"
                                th:text="|${dto.acctNo} (입금가능)|"
                                th:value="${dto.acctNo}">
                        </option>
                    </select>
                    <p class="step2-note" style="color:blue; margin-top:5px;">※ 환전된 원화는 즉시 입금됩니다.</p>
                </div>
            </div>

            <div class="step2-actions">
                <button type="button" class="step2-btn-next">환전하기</button>
            </div>

        </form>
    </div>

    <div id="couponModal" class="coupon-modal" style="display:none;">
        <div class="coupon-modal-content">
            <h3>쿠폰 선택</h3>
            <ul th:if="${not #lists.isEmpty(couponDTOList)}">
                <li th:each="dto : ${couponDTOList}">
                    <button class="coupon-option"
                            th:data-discount="${dto.coupRate / 100.0}"
                            th:text="|환전 수수료 ${dto.coupRate}% 우대 쿠폰|">
                        수수료 할인 쿠폰
                    </button>
                </li>
            </ul>
            <button id="couponClose" class="coupon-close">닫기</button>
        </div>
    </div>

</main>
<div th:replace="~{_template/_footer.html}"></div>
<script th:src="@{/js/exchange.js}"></script>

</body>
</html>