<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{admin/admin_template :: admin_template('Í¥ÄÎ¶¨Ïûê Î©îÏù∏','ÎåÄÏãúÎ≥¥Îìú',~{::content},~{::script})}">

<th:block th:fragment="content">

    <!-- 1Ìñâ: Î∞©Î¨∏¬∑Í±∞Îûò ÌÜµÍ≥Ñ ÏÑπÏÖò -->
    <section class="section">
        <div class="section-header">
            <h2>Ïò§Îäò Ï£ºÏöî ÌÜµÍ≥Ñ</h2>
        </div>

        <div class="admin-stats-row admin-stats-row--today">
            <!-- dÏõêÌôî -->
            <article class="admin-stat-card admin-stat-card--krw">
                <h3> ÏõêÌôî Í±∞Îûò Ïàò
                    <span th:text="|(${#temporals.format(baseTime,'yyyy.MM.dd HH:mm:ss')} Í∏∞Ï§Ä)|"></span>
                </h3>
                <div class="admin-graph-box admin-summary-cards">
                    <div class="krw-summary-row">
                        <div class="krw-summary-block krw-summary-block--count">
                            <h4>Ï¥ù Í±∞Îûò Í±¥Ïàò</h4>
                            <p class="summary-value" id="totalTxCountText">0Í±¥</p>
                            <p class="summary-sub">
                                <span id="totalTxCountDiff" class="diff diff-up">+0%</span>
                                <span class="diff-label">Ï†ÑÏùº ÎåÄÎπÑ</span>
                            </p>
                        </div>
                        <div class="summary-mini-chart">
                            <canvas id="krwCountMiniChart"></canvas>
                        </div>
                    </div>

                    <div class="summary-card">
                        <div class="krw-summary-block krw-summary-block--amount">
                            <h4>Ï¥ù Í±∞Îûò Í∏àÏï°</h4>
                            <p class="summary-value" id="totalTxAmountText">0Ïõê</p>
                            <p class="summary-sub">
                                <span id="totalTxAmountDiff" class="diff diff-down">-0%</span>
                                <span class="diff-label">Ï†ÑÏùº ÎåÄÎπÑ</span>
                            </p>
                        </div>
                        <div class="summary-mini-chart">
                            <canvas id="krwAmountMiniChart"></canvas>
                        </div>
                    </div>
                </div>
            </article>

            <!-- Ïô∏Ìôî Í±¥Ïàò -->
            <article class="admin-stat-card admin-stat-card--fx">
                <h3>Ïô∏Ìôî Í±∞Îûò Ïàò
                    <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} Í∏∞Ï§Ä)|"></span>
                </h3>
                <div class="fx-chart-box">
                    <canvas id="fxChart"></canvas>
                </div>

            </article>
        </div>
    </section>

    <!-- 4Ìñâ: Í∞ÄÏûÖÏûêÏàò Ï∂îÏù¥ -->
    <section class="section">
        <div class="section-header">
            <h2>ÏÉÅÌíà Í∞ÄÏûÖ</h2>
        </div>

        <div class="admin-stats-row-3">
            <article class="admin-stat-card-3 admin-graph-card">
                <h3>ÏùºÎ≥Ñ Í∞ÄÏûÖ Í±¥Ïàò
                    <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} Í∏∞Ï§Ä)|"></span>
                </h3>
                <div class="admin-graph-box-3">
                    <canvas id="joinDailyChart"></canvas>
                </div>
            </article>

            <article class="admin-stat-card-3 admin-graph-card">
                 <h3>Ï£ºÎ≥Ñ Í∞ÄÏûÖ Í±¥Ïàò
                        <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} Í∏∞Ï§Ä)|"></span>
                    </h3>
                <div class="admin-graph-box-3">
                   <canvas id="joinWeeklyChart"></canvas>
                </div>
            </article>

            <article class="admin-stat-card-3 admin-graph-card">
                <h3>ÏõîÎ≥Ñ Í∞ÄÏûÖ Í±¥Ïàò
                        <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} Í∏∞Ï§Ä)|"></span>
                    </h3>
                <div class="admin-graph-box-3">
                   <canvas id="joinMonthlyChart"></canvas>
                </div>
            </article>
        </div>
    </section>

    <!-- 2Ìñâ: Ïó∞Î†π¬∑ÏÑ±Î≥Ñ Î∂ÑÌè¨ -->
    <section class="section">
        <div class="admin-stats-row">
            <article class="admin-stat-card admin-graph-card">
                <h3>Ïó∞Î†πÎåÄÎ≥Ñ Î∂ÑÌè¨
                    <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} Í∏∞Ï§Ä)|"></span>
                </h3>
                <div class="admin-graph-box">
                    <canvas id="ageChart"></canvas>
                </div>
            </article>

            <article class="admin-stat-card admin-graph-card">
                  <h3>ÏÑ±Î≥Ñ ÎπÑÏú®
                    <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} Í∏∞Ï§Ä)|"></span>
                </h3>
                <div class="admin-graph-box">
                    <canvas id="genderChart" style="width: 100%; height: 260px;"></canvas>
                </div>
            </article>
        </div>
    </section>
</th:block>

<th:block th:fragment="script">
    <script th:inline="javascript">
        /*<![CDATA[*/
        window.dashboardData = {
            // Ïò§Îäò Ï¥ù Í±∞Îûò Í±¥Ïàò / Í∏àÏï°
            todayTotalTxCount:  [[${stats != null ? stats.todayTotalTxCount : 0}]],
            todayTotalTxAmount: [[${stats != null ? stats.todayTotalTxAmount : 0}]],

        // Ïò§Îäò ÌôòÏ†Ñ¬∑Ïô∏ÌôîÏÜ°Í∏à Í±¥Ïàò Î¶¨Ïä§Ìä∏
        todayFxTxCounts: [
            /*[# th:if="${stats != null && stats.todayTxCounts != null}"]*/
            /*[# th:each="tx, iterStat : ${stats.todayTxCounts}"]*/
            {
                // Î¨∏ÏûêÏó¥ÏùÄ JS Ï£ºÏÑù Ïù∏ÎùºÏù∏ Î∞©ÏãùÏúºÎ°ú ÏïàÏ†ÑÌïòÍ≤å ÎÑ£Í∏∞
                type: /*[[${tx.type}]]*/"",
                count: [[${tx.count}]]
            }/*[# th:if="${!iterStat.last}"]*/,/*[/]*/
            /*[/]*/
            /*[/]*/
        ],

            // üîπ ÏµúÍ∑º 7Ïùº (null ÏïàÏ†ÑÌïòÍ≤å Ï≤òÎ¶¨)
        last7Days: [
        /*[# th:if="${stats != null && stats.last7Days != null}"]*/
        /*[# th:each="d, iter : ${stats.last7Days}"]*/
        {
            date: '[[${d != null && d.baseDate != null ? #temporals.format(d.baseDate, "MM/dd") : ""}]]',
            count: [[${d != null ? d.count : 0}]],
        amount: [[${d != null ? d.amount : 0}]]
        }/*[# th:if="${!iter.last}"]*/,/*[/]*/
        /*[/]*/
        /*[/]*/
        ],
        dailyJoinStats: [
            /*[# th:if="${stats != null and stats.dailyJoinStats != null}"]*/
            /*[# th:each="j, iter : ${stats.dailyJoinStats}"]*/
            {
                // baseDateÎäî String Ïù¥Îùº Í∑∏ÎÉ• Î¨∏ÏûêÏó¥Î°ú Ï∂úÎ†•
                baseDate: '[[${j != null ? j.baseDate : ""}]]',
                // joinCountÎäî Ïà´Ïûê, jÍ∞Ä nullÏù¥Î©¥ 0
                joinCount: [[${j != null ? j.joinCount : 0}]]
        }/*[# th:if="${!iter.last}"]*/,/*[/]*/
        /*[/]*/
        /*[/]*/
        ],

        weeklyJoinStats: [
            /*[# th:if="${stats != null and stats.weeklyJoinStats != null}"]*/
            /*[# th:each="j, iter : ${stats.weeklyJoinStats}"]*/
            {
                baseDate: '[[${j != null ? j.baseDate : ""}]]',
                joinCount: [[${j != null ? j.joinCount : 0}]]
        }/*[# th:if="${!iter.last}"]*/,/*[/]*/
        /*[/]*/
        /*[/]*/
        ],
        monthlyJoinStats: [
            /*[# th:if="${stats != null and stats.monthlyJoinStats != null}"]*/
            /*[# th:each="j, iter : ${stats.monthlyJoinStats}"]*/
            {
                baseDate: '[[${j != null ? j.baseDate : ""}]]',
                joinCount: [[${j != null ? j.joinCount : 0}]]
        }/*[# th:if="${!iter.last}"]*/,/*[/]*/
        /*[/]*/
        /*[/]*/
        ],
        ageStats: [
            /*[# th:if="${stats != null and stats.ageStats != null}"]*/
            /*[# th:each="a, iter : ${stats.ageStats}"]*/
            {
                ageBand: '[[${a != null ? a.ageStats : ""}]]',
                count:   [[${a != null ? a.count   : 0}]]
        }/*[# th:if="${!iter.last}"]*/,/*[/]*/
        /*[/]*/
        /*[/]*/
        ],
        genderStats: [
            /*[# th:if="${stats != null and stats.genderStats != null}"]*/
            /*[# th:each="g, iter : ${stats.genderStats}"]*/
            {
                gender: '[[${g != null ? g.gender : ""}]]',
                count: [[${g != null ? g.count : 0}]]
        }/*[# th:if="${!iter.last}"]*/,/*[/]*/
        /*[/]*/
        /*[/]*/
        ]



        };
        /*]]>*/
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:src="@{/js/dashboard.js}"></script>

    <!-- 4) ÌÇ§ÏõåÎìú Ìè∞Ìä∏ ÎûúÎç§ (ÏõêÎûò ÏûàÎçò JS) -->
    <script>
        document.querySelectorAll('.admin-keyword-box span').forEach(el => {
            const randomSize = Math.floor(Math.random() * 14) + 14; // 14~28px
            el.style.fontSize = randomSize + 'px';
        });
    </script>

</th:block>
</html>
