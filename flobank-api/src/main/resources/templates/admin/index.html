<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{admin/admin_template :: admin_template('관리자 메인','대시보드',~{::content},~{::script})}">

<th:block th:fragment="content">

    <!-- 1행: 방문·거래 통계 섹션 -->
    <section class="section">
        <div class="section-header">
            <h2>오늘 주요 통계</h2>
        </div>

        <div class="admin-stats-row">
            <!-- 오늘 방문자 수 -->
            <article class="admin-stat-card admin-graph-card">
                <h3>오늘 방문자 수
                    <span th:text="|(${#temporals.format(baseTime,'yyyy.MM.dd HH:mm:ss')} 기준)|"></span>
                </h3>
                <div class="admin-graph-box">
                    <img th:src="@{/images/ex.png}" alt="오늘 방문자 수 그래프" />
                </div>
            </article>

            <!-- 오늘 거래 건수 -->
            <article class="admin-stat-card admin-graph-card">
                <h3>오늘 거래 건수
                    <span th:text="|(입출금,환전,외화송금) ${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} 기준)|"></span>
                </h3>
                <div class="admin-graph-box">
                    <canvas id="todayTxChart"></canvas>
                </div>
                <p style="color:red"
                   th:if="${stats != null}"
                   th:each="tx : ${stats.todayTxCounts}">
                    [[${tx.type}]] : [[${tx.count}]]
                </p>
            </article>
        </div>
    </section>

    <!-- 4행: 가입자수 추이 -->
    <section class="section">
        <div class="section-header">
            <h2>가입자수 추이</h2>
        </div>

        <div class="admin-stats-row-3">
            <!-- 월별 -->
            <article class="admin-stat-card-3 admin-graph-card">
                <h3>월별 가입자수
                    <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} 기준)|"></span>
                </h3>
                <div class="admin-graph-box-3">
                    <img th:src="@{/images/ex.png}" alt="월별 가입자수 그래프" />
                </div>
            </article>

<!--            &lt;!&ndash; 주별 &ndash;&gt;-->
<!--            <article class="admin-stat-card-3 admin-graph-card">-->
<!--                 <h3>주별 가입자수
                        <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} 기준)|"></span>
                    </h3>-->
<!--                <div class="admin-graph-box-3">-->
<!--                    <img th:src="@{/images/ex.png}" alt="주별 가입자수 그래프" />-->
<!--                </div>-->
<!--            </article>-->

<!--            &lt;!&ndash; 일별 &ndash;&gt;-->
<!--            <article class="admin-stat-card-3 admin-graph-card">-->
<!--                < <h3>일별 가입자수
                        <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} 기준)|"></span>
                    </h3>-->
<!--                <div class="admin-graph-box-3">-->
<!--                    <img th:src="@{/images/ex.png}" alt="일별 가입자수 그래프" />-->
<!--                </div>-->
<!--            </article>-->
        </div>
    </section>

    <!-- 2행: 연령·성별 분포 -->
    <section class="section">
        <div class="admin-stats-row">
            <article class="admin-stat-card admin-graph-card">
                <h3>연령대별 분포
                    <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} 기준)|"></span>
                </h3>
                <div class="admin-graph-box">
                    <img th:src="@{/images/ex.png}" alt="연령대별 분포 그래프" />
                </div>
            </article>

            <article class="admin-stat-card admin-graph-card">
                <h3>성별 분포
                    <span th:text="|(${#temporals.format(baseTime, 'yyyy.MM.dd HH:mm:ss')} 기준)|"></span>
                </h3>
                <div class="admin-graph-box">
                    <img th:src="@{/images/ex.png}" alt="성별 분포 그래프" />
                </div>
            </article>
        </div>
    </section>
</th:block>

<th:block th:fragment="script">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
        // DTO(List<TxCountDTO>) → JS 배열로 변환
        const txLabels = [];
        const txCounts = [];

        /*[# th:each="tx : ${stats.todayTxCounts}"]*/
        txLabels.push(/*[[${tx.type}]]*/);
        txCounts.push(/*[[${tx.count}]]*/);
        /*[/]*/

        const todayTxCtx = document.getElementById('todayTxChart');

        if (todayTxCtx) {
            new Chart(todayTxCtx, {
                type: 'bar',
                data: {
                    labels: txLabels,           // ["입출금","환전","외화송금", ...]
                    datasets: [{
                        label: '오늘 거래 건수(건)',
                        data: txCounts          // [123, 45, 7, ...]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1 }
                        }
                    }
                }
            });
        }
    </script>

    <script>
        document.querySelectorAll('.admin-keyword-box span').forEach(el => {
            const randomSize = Math.floor(Math.random() * 14) + 14; // 14~28px
            el.style.fontSize = randomSize + 'px';
        });
    </script>

</th:block>
</html>
