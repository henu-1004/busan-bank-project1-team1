<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLOBANK 메인화면_외환_1조</title>

    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">

    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
            crossorigin="anonymous"
    />

</head>
<body>
<div th:replace="~{_template/_header.html}"></div>

<section class="main-banner">
    <div class="slider">
        <div class="slides">
            <div class="slide">
                <a href="#"><img th:src="@{/images/banner2.png}" alt="banner1"></a>
            </div>
            <div class="slide">
                <a href="#"><img th:src="@{/images/banner1.png}" alt="banner2"></a>
            </div>
            <div class="slide">
                <a href="#"><img th:src="@{/images/banner3.png}" alt="banner3"></a>
            </div>
            <div class="slide">
                <a href="#"><img th:src="@{/images/banner4.png}" alt="banner4"></a>
            </div>
        </div>
    </div>

    <button class="prev"><i class="fa-solid fa-chevron-left"></i></button>
    <button class="next"><i class="fa-solid fa-chevron-right"></i></button>

    <div class="dots">
        <span class="dot active"></span>
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
    </div>
</section>

<section class="fx-wrapper">

    <!-- 왼쪽: 환율 박스 -->
    <div class="fx-left-box">
        <div class="fx-title-row">
            <h2>환율</h2>
            <span class="fx-date" th:text="${fxDate}"></span>
        </div>

        <!-- 환율 테이블 -->
        <table class="fx-table">
            <thead>
            <tr>
                <th>통화</th>
                <th>매매기준율</th>
                <th>송금받을 때</th>
                <th>송금보낼 때</th>
            </tr>
            </thead>

            <tbody id="fx-list">
            <tr>
                <td><img th:src="@{/images/usd.png}"> USD</td>
                <td id="usd-base"></td>
                <td id="usd-ttb"></td>
                <td id="usd-tts"></td>
            </tr>

            <tr>
                <td><img th:src="@{/images/jpy.png}"> JPY</td>
                <td id="jpy-base"></td>
                <td id="jpy-ttb"></td>
                <td id="jpy-tts"></td>
            </tr>

            <tr>
                <td><img th:src="@{/images/eur.png}"> EUR</td>
                <td id="eur-base"></td>
                <td id="eur-ttb"></td>
                <td id="eur-tts"></td>
            </tr>

            <tr>
                <td><img th:src="@{/images/cnh.png}"> CNY</td>
                <td id="cny-base"></td>
                <td id="cny-ttb"></td>
                <td id="cny-tts"></td>
            </tr>
            </tbody>
        </table>

        <!-- 하단 버튼 -->
        <div class="fx-bottom-btns">
            <a th:href="@{/rate/rate_calc}" class="fx-btn-link">환율계산기</a>
            <a th:href="@{/rate/rate_info}" class="fx-btn-link">환율 전체 보기</a>
        </div>
    </div>

    <!-- 오른쪽: 기능 박스 3개 -->
    <div class="fx-right-box">

        <a th:href="@{/exchange/step1}" class="fx-card purple">
            <div class="fx-card-text">
                <h3>환전</h3>
                <p>다양한 통화 실시간 환전</p>
            </div>
            <img th:src="@{/images/main1.png}" class="fx-card-img">
        </a>

        <a th:href="@{/deposit/list}" class="fx-card blue">
            <div class="fx-card-text">
                <h3>외화예금</h3>
                <p>FLOBANK의 다양한 외화예금 상품</p>
            </div>
            <img th:src="@{/images/main2.png}" class="fx-card-img">
        </a>

        <a th:href="@{/remit/en_transfer_1}" class="fx-card mint">
            <div class="fx-card-text">
                <h3>외화송금</h3>
                <p>빠르고 안전한 해외송금</p>
            </div>
            <img th:src="@{/images/main3.png}" class="fx-card-img">
        </a>
    </div>
</section>


<section class="briefing-section">
    <div class="briefing-container">

        <div class="briefing-box">
            <div class="briefing-top">
                <div class="briefing-tabs">
                    <a href="#" data-mode="oneday"
                       th:class="${briefingMode} == 'oneday' ? 'active' : ''">
                        오늘의 브리핑
                    </a>

                    <a href="#" data-mode="recent5"
                       th:class="${briefingMode} == 'recent5' ? 'active' : ''">
                        최근 5일 브리핑
                    </a>
                </div>
                <div class="more">
                    <a id="briefing-more" th:href="@{/articles(mode=${briefingMode})}">+ 더보기</a>
                </div>
            </div>

            <!-- 동적 제목 + 날짜 -->
            <h3>
                <span data-briefing-title th:text="${briefingTitle}">오늘의 브리핑</span>
                <span data-briefing-date th:text="'(' + briefingDateText + ')'"></span>
            </h3>

            <!-- 브리핑 내용 -->
            <ul class="briefing-list" data-briefing-lines>
                <li th:each="line : ${briefingLines}"
                    th:text="${line}">
                </li>

                <!-- 브리핑이 없는 경우 -->
                <li th:if="${briefingLines == null}">
                    아직 생성된 브리핑이 없습니다.
                </li>
            </ul>
        </div>
    </div>
</section>


<section class="board-section">
    <div class="board-container">

        <div class="board-box">
            <h3>공지사항</h3>
            <ul>
                <li th:each="n : ${noticeList}">
                    <a th:href="@{/customer/notice_view/{id}(id=${n.boardNo})}"
                       th:text="${n.boardTitle}"></a>
                    <span th:text="${#temporals.format(n.boardRegDt, 'yyyy.MM.dd')}"></span>
                </li>
            </ul>


            <div class="more"><a th:href="@{/customer/notice_list}">+ 더보기</a></div>
        </div>

        <div class="board-box">
            <h3>이벤트</h3>
            <ul>
                <li th:each="e : ${eventList}">
                    <a th:href="@{/customer/event_view/{id}(id=${e.boardNo})}"
                       th:text="${e.boardTitle}"></a>
                    <span th:text="${#temporals.format(e.boardRegDt, 'yyyy.MM.dd')}"></span>
                </li>
            </ul>


            <div class="more"><a th:href="@{/customer/event_list}">+ 더보기</a></div>
        </div>

    </div>
</section>
<div th:replace="~{_template/_footer.html}"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tabs = document.querySelectorAll('.briefing-tabs a');
        const titleEl = document.querySelector('[data-briefing-title]');
        const dateEl = document.querySelector('[data-briefing-date]');
        const linesEl = document.querySelector('[data-briefing-lines]');
        const moreLink = document.getElementById('briefing-more');

        function renderBriefing(data) {
            tabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === data.briefingMode);
            });

            titleEl.textContent = data.briefingTitle || '브리핑';
            dateEl.textContent = data.briefingDateText ? `(${data.briefingDateText})` : '';

            linesEl.innerHTML = '';
            if (data.briefingLines && data.briefingLines.length > 0) {
                data.briefingLines.forEach(line => {
                    const li = document.createElement('li');
                    li.textContent = line;
                    linesEl.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = '아직 생성된 브리핑이 없습니다.';
                linesEl.appendChild(li);
            }

            if (moreLink && data.briefingMode) {
                moreLink.href = `/flobank/articles?mode=${data.briefingMode}`;
            }
        }

        function fetchBriefing(mode) {
            fetch(`/flobank/api/briefing?mode=${mode}`)
                .then(res => res.json())
                .then(renderBriefing)
                .catch(() => {});
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                const mode = tab.dataset.mode;
                if (!mode) return;
                fetchBriefing(mode);
            });
        });
    });
</script>


<script>
    function getToday() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function renderMainRate(data) {
        const targets = {
            "USD": { base: "#usd-base", ttb: "#usd-ttb", tts: "#usd-tts" },
            "JPY(100)": { base: "#jpy-base", ttb: "#jpy-ttb", tts: "#jpy-tts" },
            "EUR": { base: "#eur-base", ttb: "#eur-ttb", tts: "#eur-tts" },
            "CNH": { base: "#cny-base", ttb: "#cny-ttb", tts: "#cny-tts" }
        };

        data.forEach(item => {
            const cur = item.cur_unit;

            if (targets[cur]) {
                document.querySelector(targets[cur].base).textContent =
                    item.kftc_deal_bas_r || item.deal_bas_r || "-";

                document.querySelector(targets[cur].ttb).textContent =
                    item.ttb || "-";

                document.querySelector(targets[cur].tts).textContent =
                    item.tts || "-";
            }
        });
    }

    async function loadMainRate() {
        const today = getToday();

        try {
            const res = await fetch(`/flobank/rate/data?date=${today}`);
            const data = await res.json();

            if (!data || data.length === 0) {
                console.warn("환율 없음");
                return;
            }

            renderMainRate(data);

        } catch (err) {
            console.error("환율 로드 오류:", err);
        }
    }

    document.addEventListener("DOMContentLoaded", loadMainRate);
</script>




</body>
</html>
